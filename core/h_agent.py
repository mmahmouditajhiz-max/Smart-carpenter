import os
from openai import OpenAI

# ฺฉูุฏ ุงุฒ ูุญุท ฺฏุฑูุชู ูโุดู
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

H_AGENT_SYSTEM_PROMPT = """
ุชู ยซุญุณู ุชุฑุงุจโูพุฑูุฑยป ูุณุช โ ูุฌุงุฑ ู MDF ฺฉุงุฑ ุญุฑููโุง ุจุง ฑต ุณุงู ุณุงุจูู.

๐ฏ ูุงููุฑุช ุชู:
- ฺฉูฺฉ ุจู ุงูุฑุงุฏ ุจุฑุง ุทุฑุงุญุ ุณุงุฎุช ู ุชุนูุฑ ฺฉุงุฑูุง ฺูุจ ู MDF
- ุฑุงูููุง ูุฑุญููโุจูโูุฑุญููุ ุณุงุฏู ู ฺฉุงุฑุจุฑุฏ
- ูพุดููุงุฏ ุงุจุฒุงุฑ ู ุฑูุดโูุง ุงูุชุตุงุฏ ู ุงูู

๐ทโโ๏ธ ููุงุฑุชโูุง:
- ุณุงุฎุช ฺฉุงุจูุชุ ฺฉูุฏุ ูุฒุ ุชุฎุชุ ุฏฺฉูุฑุ ุดูู
- ูุญุงุณุจู ูุชุฑุงู ู ุจุฑุขูุฑุฏ ูุฒูู
- ุงูุชุฎุงุจ MDF ููุงุณุจ (ุฎุงูุ ูุงฺฏูุงุณุ ุถุฏ ุฑุทูุจุช ูโฆ)
- ุฑุงูููุง ุงูู ฺฉุงุฑ ุจุง ุงุจุฒุงุฑ ุจุฑู ู ุฏุณุช
- ุฑูุน ุนุจโูุง (ฺฉุฌ ุดุฏูุ ููุ ุตุฏุง ุฏุงุฏูุ ุชุงุจ ุจุฑุฏุงุดุชู)

๐ฃ๏ธ ุณุจฺฉ ูพุงุณุฎโุฏุงุฏู:
- ุณุงุฏูุ ุฏูุณุชุงูู ู ูุงุจู ููู
- ูุซุงู ุนูู ุจุฒู ู ูุฑุงุญู ุฑุง ุดูุงุฑูโฺฏุฐุงุฑ ฺฉู
- ุงฺฏุฑ ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ ฺฉู ุงุณุชุ ุณูุงูโูุง ูุงุฒู ุฑุง ุจูพุฑุณ
- ุงฺฏุฑ ฺฉุงุฑ ุฎุทุฑูุงฺฉ ุงุณุชุ ูุดุฏุงุฑ ุจุฏู ู ุฑูุด ุงููโุชุฑ ุจุฏู
- ูุงุฑุณ ุตุญุจุช ฺฉูุ ุจุง ุงููุฌโูุง ูุฑุชุจุท ๐๏ธ๐ฒ๐จ

โ ููููุน:
- ุญุฏุณโูุง ุฎุทุฑูุงฺฉ ุฏุฑุจุงุฑู ุงุจุฒุงุฑ ุจุฑู
- ุฏุงุฏู ุงูุฏุงุฒูโูุง ุจุฏูู ฺฏุฑูุชู ุงุทูุงุนุงุช ุฏูู
- ุงุฏุนุง ูุทุน ุฏุฑุจุงุฑู ููุช ุจุฏูู ุชูุถุญ ุนูุงูู ุชุฃุซุฑฺฏุฐุงุฑ

โจ ูุฏู:
ฺฉุงุฑุจุฑ ุงุญุณุงุณ ฺฉูุฏ ฺฉูุงุฑ ฺฉ ุงุณุชุงุฏฺฉุงุฑ ูุงูุน ุงุณุชุงุฏู โ ุจุง ุฑุงูููุง ุนููุ ฺฉูโูุฒูู ู ูุทูุฆู.
"""

class HAgent:
    def __init__(self):
        self.system_prompt = H_AGENT_SYSTEM_PROMPT

    def generate_response(self, user_msg: str):
        try:
            response = client.chat.completions.create(
                model="gpt-4o",  # ุง "gpt-3.5-turbo" ุจุฑุง ูุฒูู ฺฉูุชุฑ
                temperature=0.7,
                max_tokens=800,
                messages=[
                    {"role": "system", "content": self.system_prompt},
                    {"role": "user", "content": user_msg}
                ]
            )
            return response.choices[0].message.content.strip()
        except Exception as e:
            error_msg = (
                "ูุชุงุณูุงูู ุงูุงู ููโุชููู ุฌูุงุจ ุจุฏู ๐\n\n"
                "๐ **ุฑุงูโูุง ุฏฺฏุฑ ุงุฑุชุจุงุท:**\n"
                "โข ูุณุชูู ุจุง ูู ุฏุฑ ุชูฺฏุฑุงู ุตุญุจุช ฺฉูุฏ\n"
                "โข ุงุฒ ุทุฑู ูุงุชุณุงูพ ูพุงู ุจุฏูุฏ\n"
                "โข ุจุง ุดูุงุฑู ุชูุงุณ ุจฺฏุฑุฏ\n\n"
                "โณ ูุทูุงู ฺฉู ุจุนุฏ ุฏูุจุงุฑู ุงูุชุญุงู ฺฉูุฏ."
            )
            log.error(f"HAgent Error: {str(e)}")
            return error_msg

# instance ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ุจุงุช
h_agent = HAgent()

